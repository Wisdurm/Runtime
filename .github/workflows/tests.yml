name: "Catch2 - Tests"
# 100% this doesn't work but whatever, I don't give a swag
on: push

jobs:
  build-and-test:
    runs-on: "ubuntu-latest"
    steps:
      - name: "Checkout repo"
        uses: actions/checkout@v3

      - name: "Setup vcpkg"
        uses: lukka/run-vcpkg@v11

      - name: "Dependencies"
        run: |
          sudo apt-get update && \
          sudo apt-get install -yq \
          cmake \
          ninja-build \
          git \

      - name : "CMake"
        uses: lukka/run-cmake@v10
        with:
          cmakeListsTxtPath: ${{github.workspace}}/CMakeLists.txt
          workflowPreset: vcpkg

      - name: "Build"
        run: |
          cmake . -G Ninja
          ninja

      - name: "Test"
        working-directory: ${{github.workspace}}/build
        run: ctest --output-on-failure